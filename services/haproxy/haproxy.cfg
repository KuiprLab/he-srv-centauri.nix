global
    log /dev/log local0
    log /dev/log local1 notice
    user haproxy
    group haproxy
    daemon

defaults
    log global
    mode tcp
    option tcplog
    timeout connect 5s
    timeout client 30s
    timeout server 30s

frontend http_frontend
    bind *:80
    mode tcp
    # Enable PROXY protocol to preserve client IP
    # option accept-proxy  # Uncomment if upstream supports PROXY protocol
    default_backend http_backend

frontend https_frontend
    bind *:443
    mode tcp
    tcp-request inspect-delay 5s
    tcp-request content accept if { req.ssl_hello_type 1 }
    # Enable PROXY protocol to preserve client IP
    # option accept-proxy  # Uncomment if upstream supports PROXY protocol
    default_backend traefik_backend_https

backend http_backend
    mode tcp
    balance roundrobin
    # Send PROXY protocol headers to preserve client IP
    # server traefik_http 127.0.0.1:8081 check send-proxy  # Enable if Traefik supports it
    server traefik_http 127.0.0.1:8081 check

backend traefik_backend_https
    mode tcp
    # Send PROXY protocol headers to preserve client IP
    # server traefik_server 127.0.0.1:8443 check send-proxy  # Enable if Traefik supports it
    server traefik_server 127.0.0.1:8443 check

frontend prometheus
    bind *:8405
    mode http
    http-request use-service prometheus-exporter if { path /metrics }
    no log
