##############################################
#                                            #
#              Authelia Config               #
#                                            #
##############################################
# The host and port to listen on
server:
  host: 0.0.0.0
  port: 9091

# Default redirection URL
default_redirection_url: https://kuipr.de

# TOTP settings
totp:
  issuer: kuipr.de
  period: 30
  skew: 1

# Authentication backend
authentication_backend:
  file:
    path: /config/users_database.yaml
    password:
      algorithm: argon2id
      iterations: 1
      salt_length: 16
      parallelism: 8
      memory: 64

# Access control configuration
access_control:
  default_policy: one_factor
  rules:
    - domain: "sonarr.kuipr.de"
      resources:
        - "^/api/.*$"
      policy: bypass
    - domain: "radarr.kuipr.de"
      resources:
        - "^/api/.*$"
      policy: bypass
    - domain: "*.kuipr.de"
      policy: one_factor

# Session configuration
session:
  name: authelia_session
  expiration: 3600  # seconds
  inactivity: 300   # seconds
  domain: kuipr.de
  redis:
    host: redis
    port: 6379
    database_index: 0

# Storage configuration
storage:
  local:
    path: /data/db.sqlite3

# Notification settings
notifier:
  filesystem:
    filename: /data/notification.txt

# Regulation for failed attempts
regulation:
  max_retries: 3
  find_time: 120
  ban_time: 300

# Logging configuration
log:
  level: debug

# Telemetry
telemetry:
  metrics:
    enabled: false

webauthn:
  disable: false
  enable_passkey_login: true
  display_name: 'Authelia'
  attestation_conveyance_preference: 'indirect'
  timeout: '60 seconds'
  filtering:
    permitted_aaguids: []
    prohibited_aaguids: []
    prohibit_backup_eligibility: false
  selection_criteria:
    attachment: ''
    discoverability: 'preferred'
    user_verification: 'preferred'
  metadata:
    enabled: false
    validate_trust_anchor: true
    validate_entry: true
    validate_entry_permit_zero_aaguid: false
    validate_status: true
    validate_status_permitted: []
    validate_status_prohibited:
      - 'REVOKED'
      - 'USER_KEY_PHYSICAL_COMPROMISE'
      - 'USER_KEY_REMOTE_COMPROMISE'
      - 'USER_VERIFICATION_BYPASS'
      - 'ATTESTATION_KEY_COMPROMISE'

identity_providers:
  oidc:
    ## The other portions of the mandatory OpenID Connect 1.0 configuration go here.
    ## See: https://www.authelia.com/c/oidc
    clients:
      - client_id: 'jellyfin'
        client_name: 'Jellyfin'
        client_secret: '$pbkdf2-sha512$310000$c8p78n7pUMln0jzvd4aK4Q$JNRBzwAo0ek5qKn50cFzzvE9RXV88h1wJn5KGiHrD0YKtZaR/nCb2CJPOsKaPK0hjf.9yHxzQGZziziccp6Yng'  # The digest of 'insecure_secret'.
        public: false
        authorization_policy: 'two_factor'
        require_pkce: true
        pkce_challenge_method: 'S256'
        redirect_uris:
          - 'https://jelly.kuipr.de/sso/OID/redirect/authelia'
        scopes:
          - 'openid'
          - 'profile'
          - 'groups'
        userinfo_signed_response_alg: 'none'
        token_endpoint_auth_method: 'client_secret_post'
